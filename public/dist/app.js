angular.module("userApp",["ngAnimate","app.routes","authService","userService","lunchService","eventService","mainCtrl","userCtrl","lunchCtrl","eventCtrl"]).config(["$httpProvider",function(e){e.interceptors.push("AuthInterceptor")}]),angular.module("app.routes",["ngRoute"]).config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"app/views/pages/home.html"}).when("/login",{templateUrl:"app/views/pages/login.html",controller:"mainController",controllerAs:"login"}).when("/create_account",{templateUrl:"app/views/pages/new_user.html",controller:"mainController",controllerAs:"account"}).when("/users",{templateUrl:"app/views/pages/users/all.html",controller:"userController",controllerAs:"user"}).when("/users/create",{templateUrl:"app/views/pages/users/single.html",controller:"userCreateController",controllerAs:"user"}).when("/users/:user_id",{templateUrl:"app/views/pages/users/single.html",controller:"userEditController",controllerAs:"user"}).when("/lunches",{templateUrl:"app/views/pages/lunches/all.html",controller:"lunchController",controllerAs:"lunch"}).when("/lunches/create",{templateUrl:"app/views/pages/lunches/single.html",controller:"lunchCreateController",controllerAs:"lunch"}).when("/lunches/:lunch_id",{templateUrl:"app/views/pages/lunches/single.html",controller:"lunchEditController",controllerAs:"lunch"}).when("/lunches/:lunch_id/attendees",{templateUrl:"app/views/pages/lunches/attendees.html",controller:"lunchAttendeesController",controllerAs:"attendees"}).when("/events",{templateUrl:"app/views/pages/events/all.html",controller:"eventController",controllerAs:"event"}).when("/events/create",{templateUrl:"app/views/pages/events/single.html",controller:"eventCreateController",controllerAs:"event"}).when("/events/:event_id",{templateUrl:"app/views/pages/events/single.html",controller:"eventEditController",controllerAs:"event"}).when("/events/:event_id/attendees",{templateUrl:"app/views/pages/events/attendees.html",controller:"eventAttendeesController",controllerAs:"attendees"}),t.html5Mode(!0)}]),angular.module("eventCtrl",["eventService"]).controller("eventController",["Event",function(e){var t=this;t.processing=!0,e.all().success(function(e){t.processing=!1,t.events=e}),t.deleteEvent=function(n){t.processing=!0,e["delete"](n).success(function(n){e.all().success(function(e){t.processing=!1,t.events=e})})}}]).controller("eventCreateController",["Event",function(e){var t=this;t.type="create",t.saveEvent=function(){t.processing=!0,t.message="",e.create(t.eventData).success(function(e){t.processing=!1,t.eventData={},t.message=e.message})}}]).controller("eventEditController",["$routeParams","Event",function(e,t){var n=this;n.type="edit",t.get(e.event_id).success(function(e){n.eventData=e}),n.saveEvent=function(){n.processing=!0,n.message="",t.update(e.event_id,n.eventData).success(function(e){n.processing=!1,n.eventData={},n.message=e.message})}}]).controller("eventAttendeesController",["$routeParams","Event",function(e,t){var n=this;n.users="",n.eventAttendees="",n.processing=!0,t.getAllUsers().success(function(e){n.users=e}),t.getAttendees(e.event_id).success(function(e){n.processing=!1,n.eventAttendees=e.attendees,n.count=n.eventAttendees.length}),n.signInUser=function(s){t.addAttendee(e.event_id,s).success(function(e){n.eventAttendees=e.attendees,n.count=n.eventAttendees.length})},n.signOutUser=function(s){t.deleteAttendee(e.event_id,s).success(function(e){n.eventAttendees=e.attendees,n.count=n.eventAttendees.length})},n.isSignedIn=function(e){for(var t=0;t<n.eventAttendees.length;t++)if(n.eventAttendees[t]._id==e)return!0;return!1}}]),angular.module("lunchCtrl",["lunchService"]).controller("lunchController",["Lunch",function(e){var t=this;t.processing=!0,e.all().success(function(e){t.processing=!1,t.lunches=e}),t.deleteLunch=function(n){t.processing=!0,e["delete"](n).success(function(n){e.all().success(function(e){t.processing=!1,t.lunches=e})})}}]).controller("lunchCreateController",["Lunch",function(e){var t=this;t.type="create",t.saveLunch=function(){t.processing=!0,t.message="",e.create(t.lunchData).success(function(e){t.processing=!1,t.lunchData={},t.message=e.message})}}]).controller("lunchEditController",["$routeParams","Lunch",function(e,t){var n=this;n.type="edit",t.get(e.lunch_id).success(function(e){n.lunchData=e}),n.saveLunch=function(){n.processing=!0,n.message="",t.update(e.lunch_id,n.lunchData).success(function(e){n.processing=!1,n.lunchData={},n.message=e.message})}}]).controller("lunchAttendeesController",["$routeParams","Lunch",function(e,t){var n=this;n.users="",n.lunchAttendees="",n.processing=!0,t.getAllUsers().success(function(e){n.users=e}),t.getAttendees(e.lunch_id).success(function(e){n.processing=!1,n.lunchAttendees=e.attendees,n.count=n.lunchAttendees.length}),n.signInUser=function(s){t.addAttendee(e.lunch_id,s).success(function(e){n.lunchAttendees=e.attendees,n.count=n.lunchAttendees.length})},n.signOutUser=function(s){t.deleteAttendee(e.lunch_id,s).success(function(e){n.lunchAttendees=e.attendees,n.count=n.lunchAttendees.length})},n.isSignedIn=function(e){for(var t=0;t<n.lunchAttendees.length;t++)if(n.lunchAttendees[t]._id==e)return!0;return!1}}]),angular.module("mainCtrl",[]).controller("mainController",["$rootScope","$location","Auth",function(e,t,n){var s=this;s.loggedIn=n.isLoggedIn(),e.$on("$routeChangeStart",function(){s.loggedIn=n.isLoggedIn(),n.getUser().then(function(e){s.user=e.data})}),s.doLogin=function(){s.processing=!0,s.error="",n.login(s.loginData.email,s.loginData.password).success(function(e){s.processing=!1,e.success?t.path("/users"):s.error=e.message})},s.doLogout=function(){n.logout(),s.user="",t.path("/")},s.createUser=function(){n.createUser(s.signupData).success(function(e){t.path("/login")})}}]),angular.module("userCtrl",["userService"]).controller("userController",["User",function(e){var t=this;t.processing=!0,e.all().success(function(e){t.processing=!1,t.users=e}),t.deleteUser=function(n){t.processing=!0,e["delete"](n).success(function(n){e.all().success(function(e){t.processing=!1,t.users=e})})}}]).controller("userCreateController",["User",function(e){var t=this;t.type="create",t.saveUser=function(){t.processing=!0,t.message="",e.create(t.userData).success(function(e){t.processing=!1,t.userData={},t.message=e.message})}}]).controller("userEditController",["$routeParams","User",function(e,t){var n=this;n.type="edit",t.get(e.user_id).success(function(e){n.userData=e}),n.saveUser=function(){n.processing=!0,n.message="",t.update(e.user_id,n.userData).success(function(e){n.processing=!1,n.userData={},n.message=e.message})}}]),angular.module("authService",[]).factory("Auth",["$http","$q","AuthToken",function(e,t,n){var s={};return s.login=function(t,s){return e.post("/api/authenticate",{email:t,password:s}).success(function(e){return n.setToken(e.token),e})},s.logout=function(){n.setToken()},s.isLoggedIn=function(){return n.getToken()?!0:!1},s.getUser=function(){return n.getToken()?e.get("/api/me",{cache:!0}):t.reject({message:"User has no token."})},s.createUser=function(t){return e.post("/api/createUser",{first:t.first,last:t.last,employeeId:t.employeeId,email:t.email,password:t.password}).success(function(e){return n.setToken(e.token),e})},s}]).factory("AuthToken",["$window",function(e){var t={};return t.getToken=function(){return e.localStorage.getItem("token")},t.setToken=function(t){t?e.localStorage.setItem("token",t):e.localStorage.removeItem("token")},t}]).factory("AuthInterceptor",["$q","$location","AuthToken",function(e,t,n){var s={};return s.request=function(e){var t=n.getToken();return t&&(e.headers["x-access-token"]=t),e},s.responseError=function(s){return 403==s.status&&(n.setToken(),t.path("/login")),e.reject(s)},s}]),angular.module("eventService",[]).factory("Event",["$http",function(e){var t={};return t.get=function(t){return e.get("/api/events/"+t)},t.all=function(){return e.get("/api/events/")},t.create=function(t){return e.post("/api/events/",t)},t.update=function(t,n){return e.put("/api/events/"+t,n)},t["delete"]=function(t){return e["delete"]("/api/events/"+t)},t.getAttendees=function(t){return e.get("/api/events/"+t+"/attendees")},t.addAttendee=function(t,n){return e.put("/api/events/"+t+"/attendees/"+n)},t.deleteAttendee=function(t,n){return e["delete"]("api/events/"+t+"/attendees/"+n)},t.getAllUsers=function(){return e.get("/api/users/")},t}]),angular.module("lunchService",[]).factory("Lunch",["$http",function(e){var t={};return t.get=function(t){return e.get("/api/lunches/"+t)},t.all=function(){return e.get("/api/lunches/")},t.create=function(t){return e.post("/api/lunches/",t)},t.update=function(t,n){return e.put("/api/lunches/"+t,n)},t["delete"]=function(t){return e["delete"]("/api/lunches/"+t)},t.getAttendees=function(t){return e.get("/api/lunches/"+t+"/attendees")},t.addAttendee=function(t,n){return e.put("/api/lunches/"+t+"/attendees/"+n)},t.deleteAttendee=function(t,n){return e["delete"]("api/lunches/"+t+"/attendees/"+n)},t.getAllUsers=function(){return e.get("/api/users/")},t}]),angular.module("userService",[]).factory("User",["$http",function(e){var t={};return t.get=function(t){return e.get("/api/users/"+t)},t.all=function(){return e.get("/api/users/")},t.create=function(t){return e.post("/api/users/",t)},t.update=function(t,n){return e.put("/api/users/"+t,n)},t["delete"]=function(t){return e["delete"]("/api/users/"+t)},t}]);